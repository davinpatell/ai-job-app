default_platform(:ios)

platform :ios do
  desc "Build and upload to TestFlight"
  lane :beta do
    if ENV['ASC_KEY_ID'] && ENV['ASC_ISSUER_ID'] && ENV['ASC_KEY_CONTENT']
      app_store_connect_api_key(
        key_id: ENV['ASC_KEY_ID'],
        issuer_id: ENV['ASC_ISSUER_ID'],
        key_content: ENV['ASC_KEY_CONTENT']
      )
    end

    match(type: "appstore", readonly: true)
    increment_build_number(xcodeproj: "AIJobApp.xcodeproj")
    build_app(
      workspace: "AIJobApp.xcworkspace",
      scheme: "AIJobApp",
      export_method: "app-store",
      clean: true
    )
    upload_to_testflight(skip_waiting_for_build_processing: true)
  end

  desc "Deploy to App Store"
  lane :release do
    capture_screenshots
    build_app(
      workspace: "AIJobApp.xcworkspace",
      scheme: "AIJobApp",
      export_method: "app-store"
    )
    deliver(force: true)
  end
end
